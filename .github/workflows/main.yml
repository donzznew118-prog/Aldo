name: Quick Tailscale VPS

on: workflow_dispatch

jobs:
  vps:
    runs-on: ubuntu-latest
    timeout-minutes: 360
    
    steps:
    - name: Start Tailscale Directly
      run: |
        echo "ðŸš€ Creating Tailscale session..."
        
        # Install Tailscale
        curl -fsSL https://tailscale.com/install.sh | sh
        
        # Start Tailscale dengan exit node
        sudo tailscale up \
          --authkey=tskey-auth-knXFQBkQ5521CNTRL-BDXhLbHuJKMfEvULZhbfJMwPjNm7wPxe \
          --hostname="github-vps-aldo" \
          --accept-routes \
          --advertise-exit-node
        
        echo ""
        echo "========================================"
        echo "âœ… TAILSCALE VPS READY!"
        echo "========================================"
        echo ""
        
        # Get Tailscale IP
        MY_IP=$(tailscale ip --4)
        echo "ðŸ“¡ Your Tailscale IP: $MY_IP"
        echo ""
        echo "ðŸ”— Access this VPS from any device with Tailscale!"
        echo ""
        echo "ðŸ’» SSH into this VPS from another device:"
        echo "   ssh ubuntu@github-vps-aldo"
        echo "   or"
        echo "   ssh ubuntu@$MY_IP"
        echo ""
        echo "ðŸ”§ This VPS can be used as:"
        echo "   â€¢ SSH jump host"
        echo "   â€¢ Exit node (VPN)"
        echo "   â€¢ Development server"
        echo ""
        echo "â° Will run for 6 hours"
        echo "========================================"
        
    - name: Keep Session Alive
      run: |
        echo "ðŸ”„ Keeping VPS alive..."
        
        # Display status periodically
        while true; do
          echo "[$(date)] VPS Status:"
          echo "IP: $(tailscale ip --4 2>/dev/null || echo 'Getting IP...')"
          echo "Devices in network: $(tailscale status 2>/dev/null | grep -c '^100' || echo '0')"
          echo "---"
          sleep 60
        done
